# カリグラフィブラシシミュレーション

ブラウザで動作する高機能ペイント・カリグラフィブラシシミュレーションです。HTML5 Canvas、JavaScript、Fabric.jsを使用して、筆圧や速度に対応するリアルな筆とカリグラフィブラシの表現を実現しています。

## 機能

- **筆圧感知**: ペンタブレットやタッチデバイスの筆圧に対応し、線の太さや濃さが変化
- **速度効果**: ストロークの速度に応じて線質が変化（速く描くと細く薄く）
- **インクブラシ**: 毛先の散らばりやにじみ効果を再現した自然な筆表現
- **カリグラフィブラシ**: 角度に応じて太さが変わる西洋書道風表現
- **インク効果**: インクの流量、にじみ、かすれなどのリアルな表現
- **レイヤー対応**: 複数レイヤーの管理と合成
- **元に戻す/やり直し**: 操作履歴の管理

## 技術スタック

- **HTML5 Canvas**: 描画基盤
- **JavaScript**: アプリケーションロジック
- **Fabric.js**: キャンバス操作の拡張
- **Pointer Events API**: 筆圧検出とマルチタッチ対応

## 使い方

1. ブラウザで `index.html` を開きます
2. 左側のツールパネルからブラシタイプを選択します
   - **インクブラシ**: 自然な毛筆表現
   - **カリグラフィブラシ**: 角度固定の平筆表現
3. ブラシのパラメータを調整します
   - **サイズ**: ブラシの大きさ
   - **インク流量**: インクの供給量（低いと早くかすれる）
   - **筆圧感度**: 筆圧に対する反応の強さ
   - **速度効果**: 描画速度による影響の強さ
   - **角度**: カリグラフィブラシの角度
   - **カラー**: ブラシの色
4. キャンバスに描画します
   - ペンタブレットやタッチデバイスでは筆圧を検出
   - マウスでも描画可能（筆圧一定）

## テクスチャについて

このアプリケーションでは2種類のテクスチャを使用しています。

### ブラシテクスチャ (bristle_scattered.png)

- サイズ: 推奨 256x256 または 512x512 ピクセル
- フォーマット: PNG（アルファチャンネル付き）
- 特徴: バラバラに散らばった毛先のブラシチップ
- 用途: 毛筆やドライブラシ効果

### 紙テクスチャ (paper_smooth.png)

- サイズ: 推奨 1024x1024 ピクセル（シームレスなタイリング）
- フォーマット: PNG（グレースケールまたはRGBA）
- 特徴: 微細な凹凸を持つ滑らかな紙の質感
- 用途: 上質紙や和紙風効果

これらのテクスチャを `assets/brushes/` および `assets/textures/` ディレクトリに配置してください。テクスチャはアルファチャンネル付きPNGで、透過部分を適切に設定する必要があります。後からテクスチャを追加することで簡単に拡張できます。

## 技術的詳細

### コアモジュール

- **StrokeProcessor**: ポインターの動きを追跡し、ストロークの生成と安定化
- **InkEffects**: インクのにじみ、かすれ、流量などの効果
- **BlendModes**: レイヤーの合成方法を定義
- **TextureManager**: テクスチャの読み込みと管理

### ブラシエンジン

- **Brush**: すべてのブラシタイプの基底クラス
- **InkBrush**: インクの質感を持つブラシ（毛筆、墨など）
- **CalligraphyBrush**: 角度に応じて太さが変わるカリグラフィブラシ

### システム

- **LayerManager**: 複数のキャンバスレイヤーを管理し、合成処理
- **HistoryManager**: アクション履歴を管理し、元に戻す/やり直し機能を提供

### インク効果アルゴリズム

インク効果は主に以下のアルゴリズムで実現しています：

1. **にじみ効果**: 隣接ピクセルへの色の拡散と、エッジでの濃度強化
2. **かすれ効果**: インク残量に応じたランダムスキップと紙テクスチャとの相互作用
3. **流量制御**: ストローク距離に応じたインク減少と、速度・筆圧による変化

### カリグラフィアルゴリズム

カリグラフィブラシは以下の方法で実装しています：

1. **楕円形スタンプ**: 長軸と短軸の比率による扁平なブラシチップ
2. **角度固定**: 描画方向に関わらず一定角度を維持
3. **筆圧変形**: 筆圧に応じて楕円のプロポーションを微調整

## 今後の拡張可能性

- WebGLを使用した高速化
- ブラシプリセットの保存
- 追加のブラシタイプ（水彩、油彩など）
- プロジェクト保存と読み込み機能
- より高度なレイヤーマスクとブレンドモード

## ライセンス

このプロジェクトはMITライセンスのもとで公開されています。詳細は[LICENSE](LICENSE)ファイルを参照してください。
