<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><style>*{margin:0;padding:0;box-sizing:border-box;}body{font-family:sans-serif;background:#f0f0f0;color:#333;font-size:13px;}#app{display:grid;grid-template-columns:250px 1fr;height:100vh;}.sidebar{background:#fff;border-right:1px solid #ddd;padding:10px;overflow-y:auto;}.main{display:flex;flex-direction:column;height:100vh;}.header{height:60px;padding:10px;border-bottom:1px solid #ddd;display:flex;align-items:center;justify-content:space-between;background:#fff;}.content{flex:1;overflow:auto;padding:10px;}.footer{height:30px;border-top:1px solid #ddd;padding:5px 10px;font-size:11px;color:#777;background:#fff;}h1{font-size:18px;margin-bottom:15px;}h2{font-size:15px;margin:10px 0 5px;}#img-input{display:none;}.btn{display:inline-block;padding:6px 12px;background:#4285f4;color:#fff;border:none;border-radius:3px;cursor:pointer;font-size:13px;transition:background .2s;}.btn:hover{background:#3367d6;}.btn:disabled{background:#ccc;cursor:not-allowed;}.card{margin-bottom:10px;border:1px solid #ddd;border-radius:3px;overflow:hidden;}.card-header{padding:8px;background:#f5f5f5;border-bottom:1px solid #ddd;font-weight:bold;display:flex;justify-content:space-between;align-items:center;}.card-body{padding:8px;}.thumbnail{width:100%;height:120px;display:flex;align-items:center;justify-content:center;background:#fafafa;border:1px solid #eee;cursor:pointer;overflow:hidden;}.thumbnail svg,.thumbnail img{max-width:100%;max-height:100%;}.preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px;}.settings{margin-bottom:15px;}.settings label{display:block;margin-bottom:5px;}.settings select,.settings input{width:100%;padding:5px;margin-bottom:10px;border:1px solid #ddd;border-radius:3px;}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:1000;}.modal-content{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}.modal-body{overflow:auto;}.modal-footer{margin-top:15px;text-align:right;}.close{cursor:pointer;font-size:22px;}.canvas-container{width:100%;height:400px;background:#fff;border:1px solid #ddd;}</style></head><body><div id="app"><div class="sidebar"><h1>画像トレーサー</h1><div class="settings"><label for="img-input" class="btn" style="width:100%;text-align:center;">画像を選択</label><input type="file" id="img-input" accept="image/*"><p id="file-name" style="margin:8px 0;font-size:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">選択されていません</p><h2>ライブラリ設定</h2><label for="lib-select">表示ライブラリ:</label><select id="lib-select"><option value="all">すべて表示</option><option value="potrace">Potrace.js</option><option value="imagetracer">ImageTracer.js</option><option value="paper">Paper.js</option><option value="svgjs">SVG.js</option><option value="snap">Snap.svg</option><option value="opencv">OpenCV.js</option></select><h2>オリジナル画像</h2><div class="thumbnail" id="original-thumb"><p>画像を選択してください</p></div></div><div class="libraries-status"><div class="card"><div class="card-header">処理状況</div><div class="card-body" id="status-panel"></div></div></div></div><div class="main"><div class="header"><h1>SVGトレース結果</h1><div><button id="download-all" class="btn" disabled>すべてダウンロード</button></div></div><div class="content"><div class="preview-grid" id="results-grid"></div></div><div class="footer">©2025 画像トレースライブラリデモ</div></div></div><div class="modal" id="preview-modal"><div class="modal-content"><div class="modal-header"><h2 id="modal-title">プレビュー</h2><span class="close" id="modal-close">&times;</span></div><div class="modal-body"><div class="canvas-container"><canvas id="fabric-canvas"></canvas></div></div><div class="modal-footer"><button id="modal-download" class="btn">SVGをダウンロード</button></div></div></div><script src="https://cdn.jsdelivr.net/npm/potrace@latest/dist/potrace.js"></script><script src="https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.17/paper-full.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.2/svg.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js"></script><script src="https://docs.opencv.org/4.5.5/opencv.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script><script>!function(){var e,t,n,i,a,r,s,o,l,c,d,u,p={},h={},f=document.getElementById("img-input"),g=document.getElementById("file-name"),m=document.getElementById("original-thumb"),v=document.getElementById("lib-select"),y=document.getElementById("results-grid"),b=document.getElementById("download-all"),w=document.getElementById("status-panel"),E=document.getElementById("preview-modal"),k=document.getElementById("modal-close"),S=document.getElementById("modal-title"),x=document.getElementById("modal-download"),T=document.getElementById("fabric-canvas");function C(e){var t=document.createElement("div");return t.className="thumbnail-status",t.innerHTML='<div style="color:#777">'+e+"</div>",t}function j(e,t){var n=w.querySelector('[data-lib="'+e+'"]');n||(n=document.createElement("div"),n.setAttribute("data-lib",e),n.innerHTML='<div style="display:flex;justify-content:space-between;margin-bottom:5px"><span>'+e+'</span><span class="status"></span></div><div class="progress" style="height:4px;background:#eee;border-radius:2px;overflow:hidden"><div class="progress-bar" style="width:0%;height:100%;background:#4285f4;transition:width 0.3s"></div></div>',w.appendChild(n));var i=n.querySelector(".status"),a=n.querySelector(".progress-bar");i.textContent=t,i.style.color="処理中"===t?"#ff9800":"完了"===t?"#4caf50":"#f44336",a.style.width="処理中"===t?"50%":"完了"===t?"100%":"0%"}function I(t,n,i,a){if(e){var r=document.createElement("div");r.className="card",r.innerHTML='<div class="card-header">'+t+'<button class="btn" style="padding:2px 8px;font-size:12px" disabled>ダウンロード</button></div><div class="card-body"><div class="thumbnail">'+C(n)+"</div></div>",y.appendChild(r);var s=r.querySelector(".thumbnail"),o=r.querySelector(".btn");h[t]={el:r,thumb:s,btn:o,result:"",processFunction:i,completed:!1},j(t,"準備完了"),setTimeout(function(){j(t,"処理中"),i(e,function(e,n){h[t].result=e,h[t].completed=!0,n?j(t,"エラー: "+n):(j(t,"完了"),s.innerHTML=e,o.disabled=!1,o.addEventListener("click",function(){_(t,e)}),s.addEventListener("click",function(){A(t,e)}))},a)},100)}}function A(e,t){S.textContent=e+" プレビュー",x.onclick=function(){_(e,t)};var n=new fabric.StaticCanvas(T);n.setWidth(T.parentElement.offsetWidth),n.setHeight(400),n.clear(),fabric.loadSVGFromString(t,function(e,t){if(e&&e.length>0){var i=fabric.util.groupSVGElements(e,t);i.scaleToWidth(n.getWidth()-40),i.scaleToHeight(n.getHeight()-40),i.left=n.getWidth()/2,i.top=n.getHeight()/2,n.add(i),n.renderAll()}}),E.style.display="block"}function P(e,t){var n=document.createElement("a");n.href=window.URL.createObjectURL(new Blob([t],{type:"image/svg+xml"})),n.download=e+"-trace.svg",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function _(e,t){P(e.toLowerCase(),t)}function B(){Object.keys(h).filter(function(e){return h[e].completed}).length===Object.keys(h).length&&(b.disabled=!1)}function L(t,n,a){var r=new Image;r.onload=function(){var s=document.createElement("canvas"),o=s.getContext("2d"),l=r.width,c=r.height,d=Math.min(1,800/Math.max(l,c));l=Math.floor(l*d),c=Math.floor(c*d),s.width=l,s.height=c,o.drawImage(r,0,0,l,c);var u=o.getImageData(0,0,l,c);try{if("function"==typeof Potrace){var p=new Potrace;p.setParameter({turdsize:2,turnpolicy:Potrace.TURNPOLICY_MINORITY,optcurve:!0,alphamax:1,opttolerance:.2}),p.loadImageFromCanvas(s),p.process(function(){var e=p.getSVG(1);n(e,null)})}else n("",i)}catch(e){n("",e.toString())}},r.onerror=function(){n("",a)},r.src=t}function M(e,t,n){if("function"==typeof ImageTracer)try{var i={ltres:1,qtres:1,pathomit:8,colorsampling:0,numberofcolors:2,mincolorratio:0,colorquantcycles:1,scale:1,simplifytolerance:0,roundcoords:1,viewbox:!0,desc:!1,rightangleenhance:!1,blurradius:0,blurdelta:20,strokewidth:1};ImageTracer.imageToSVG(e,function(e){t(e,null)},i)}catch(e){t("",e.toString())}else t("",n)}function O(t,a,r){var s=new Image;s.onload=function(){try{var o=document.createElement("canvas"),l=s.width,c=s.height,d=Math.min(1,400/Math.max(l,c));l=Math.floor(l*d),c=Math.floor(c*d),o.width=l,o.height=c,o.getContext("2d").drawImage(s,0,0,l,c),paper.setup(o),function(i){var r=new paper.Raster({source:o.toDataURL(),position:paper.view.center});r.onLoad=function(){try{this.visible=!1;for(var s=new paper.Group,o=new paper.Path.Rectangle({point:[0,0],size:[l,c],fillColor:"white"}),d=0;d<r.height;d+=3)for(var u=0;u<r.width;u+=3){r.getPixel(u,d).lightness<.5&&s.addChild(new paper.Path.Circle({center:[u,d],radius:1,fillColor:"black"}))}s.addChild(o),s.sendToBack(),n=paper.project.exportSVG({asString:!0,precision:3}),a(n,null),paper.project.clear()}catch(e){a("",e.toString())}}}()}catch(e){a("",e.toString())}},s.onerror=function(){a("",r)},s.src=t}function R(e,t,n){var a=new Image;a.onload=function(){try{var n=document.createElement("div"),r=a.width,s=a.height,o=Math.min(1,300/Math.max(r,s));r=Math.floor(r*o),s=Math.floor(s*o);var l=SVG().addTo(n).viewbox(0,0,r,s).size(r,s);l.rect(r,s).fill("white");var c=document.createElement("canvas");c.width=r,c.height=s;var d=c.getContext("2d");d.drawImage(a,0,0,r,s);for(var u=d.getImageData(0,0,r,s).data,p=l.group(),h=0;h<s;h+=3)for(var f=0;f<r;f+=3){var g=4*(h*r+f);(u[g]+u[g+1]+u[g+2])/3<128&&p.circle(2).fill("black").move(f-1,h-1)}i=n.innerHTML,t(i,null)}catch(e){t("",e.toString())}},a.onerror=function(){t("",n)},a.src=e}function q(e,t,n){var i=new Image;i.onload=function(){try{var n=document.createElement("div"),r=Snap(300,300);n.appendChild(r.node);var s=i.width,o=i.height,l=Math.min(1,300/Math.max(s,o));s=Math.floor(s*l),o=Math.floor(o*l),r.attr({viewBox:"0 0 "+s+" "+o});var c=r.rect(0,0,s,o).attr({fill:"white"}),d=document.createElement("canvas");d.width=s,d.height=o;var u=d.getContext("2d");u.drawImage(i,0,0,s,o);for(var p=u.getImageData(0,0,s,o).data,h=r.group(),f=0;f<o;f+=3)for(var g=0;g<s;g+=3){var m=4*(f*s+g);(p[m]+p[m+1]+p[m+2])/3<128&&h.add(r.circle(g,f,1).attr({fill:"black"}))}a=n.innerHTML,t(a,null)}catch(e){t("",e.toString())}},i.onerror=function(){t("",n)},i.src=e}function D(e,t,n){var i=new Image;i.onload=function(){try{var n=document.createElement("canvas"),a=i.width,s=i.height,o=Math.min(1,600/Math.max(a,s));a=Math.floor(a*o),s=Math.floor(s*o),n.width=a,n.height=s;var l=n.getContext("2d");l.drawImage(i,0,0,a,s);var c=l.getImageData(0,0,a,s),d=cv.matFromImageData(c),u=new cv.Mat,p=new cv.Mat;cv.cvtColor(d,u,cv.COLOR_RGBA2GRAY),cv.Canny(u,p,50,150);var h=new cv.MatVector,f=new cv.Mat;cv.findContours(p,h,f,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE);for(var g='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+a+" "+s+'" width="'+a+'" height="'+s+'"><rect width="'+a+'" height="'+s+'" fill="white"/>',m=0;m<h.size();++m){var v=h.get(m);if(v.data32S.length>=4){g+='<path d="M';for(var y=0;y<v.data32S.length;y+=2){var b=v.data32S[y],w=v.data32S[y+1];g+=0===y?b+","+w:" L"+b+","+w}g+=' Z" fill="none" stroke="black" stroke-width="1"/>'}v.delete()}g+="</svg>",r=g,t(r,null),d.delete(),u.delete(),p.delete(),h.delete(),f.delete()}catch(e){t("",e.toString())}},i.onerror=function(){t("",n)},i.src=e}function V(){y.innerHTML="",w.innerHTML="",b.disabled=!0,h={};var t=v.value;I("すべて"===t||"potrace"===t?"Potrace.js":"","処理を開始します...",L,"Potrace.jsの読み込みに失敗しました"),I("すべて"===t||"imagetracer"===t?"ImageTracer.js":"","処理を開始します...",M,"ImageTracer.jsの読み込みに失敗しました"),I("すべて"===t||"paper"===t?"Paper.js":"","処理を開始します...",O,"Paper.jsの読み込みに失敗しました"),I("すべて"===t||"svgjs"===t?"SVG.js":"","処理を開始します...",R,"SVG.jsの読み込みに失敗しました"),I("すべて"===t||"snap"===t?"Snap.svg":"","処理を開始します...",q,"Snap.svgの読み込みに失敗しました"),I("すべて"===t||"opencv"===t?"OpenCV.js":"","処理を開始します...",D,"OpenCV.jsの読み込みに失敗しました")}f.addEventListener("change",function(t){var n=t.target.files[0];if(n){g.textContent=n.name;var i=new FileReader;i.onload=function(t){e=t.target.result,m.innerHTML='<img src="'+e+'" class="original-image" style="max-width:100%;max-height:100%;">',V()},i.readAsDataURL(n)}}),v.addEventListener("change",V),k.addEventListener("click",function(){E.style.display="none"}),window.addEventListener("click",function(e){e.target===E&&(E.style.display="none")}),b.addEventListener("click",function(){Object.keys(h).forEach(function(e){h[e].completed&&P(e.toLowerCase().replace(/\s+/g,"-").replace(/\./g,"-"),h[e].result)})}),"undefined"==typeof cv&&document.addEventListener("opencvready",function(){j("OpenCV.js","読み込み完了"),e&&V()})}();</script></body></html>